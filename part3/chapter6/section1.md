# 3.6.1 Github-flowの概要


## 3.6.1.1 Github-flowの考え方

- master branchは基本的にいつでもデプロイできる状態を常に保つ
- 作業する時は、必ずtopic branchを作って、そこで作業をする
- topic branchの生存期間をできるだけ短くする
- 作業・変更をしようとしたら、すぐにpull requestを出して、メンバーにフィードバック・レビューをしてもらう
- mergeしたらすぐにプロダクションにデプロイする
- デプロイ後、プロダクションからフィードバックを受ける、問題がない場合、masterにmergeする
- merge無事に終わったら、プロダクションにもう一度デプロイする
<br><br><br>



## 3.6.1.2 Github-flowに置ける開発ステップ
<br>

開発のサイクルを回している中、様々なコミュニケーションが発生する。
すべてのステップのコミュニケーションにおいては、すべてのことにURLをつけることが望ましい。
URLがあると任意のタイミングで、任意の人がそれを辿ることが可能となる。
また、ChatツールのURL、IssueのURLなど、様々なコミュニケーションで取れるURLを活用すべき。
メールはURLを取りにくいので、できれば使用しないことをお勧めしたい。

また、開発者が各々がbranchを切って、各々のタイミングで開発を行う。全体として、非同期に、パラレルに、開発を進めることも重要。
<br><br><br>



### Step1. Decide what to do　何をすべきかを決める
コードを書き始める前に、まずはやるべきことを決める。
このステップはGitやGitHubの機能ではなく、開発における一般的な方法を用いる。
<br><br><br>



### Step2. Write it!　Share and Iterate!　コード!　そしてシェアとイテレート！
何をやるかが決まったら、branchを切って、コードを書く。

コードをちょっと書いたら（方向性が決まったら）、すぐに「何をしたか」、「これから何をしたいのか」、関連するURL、チェックリスト、メンションなどをつけて、pushする。そして、pull requestを作る。

注意として、コードを全部書いてからpull requestを作るのではなく、方向性が決まったら、すぐにみんなにそれをシェア・宣言し、議論をしながら、コードを完成させていくことが重要。
このステップに限らず、テストはCIツールで行うべく、人間はコードレビューに専念することも重要。

完了したら、すぐにステージング環境にデプロイする。
デプロイしたら、フィードバックをもらってから、修正等を行う。
<br><br><br>



### Step3. Merge and Deploy it!　マージとデプロイ！
masterブランチをtopic branchにマージし、CI/CDによりテストを実施する。テストが問題なく通過したら、プロダクションにデプロイを行う。デプロイが失敗したら、自動的にmasterでプロダクションを元の状態に戻す。

また、ChatOpsをステップ2,ステップ3に適用すべき。Chatを使うことで、透明性が高まり、いつでもどこでも同じ作業ができる。
一連の状況がChatに反映し、Chatからしかデプロイできないようにすることが望ましい。
また、今誰がプロダクションにデプロイして、誰が待っているかを表示し、キューイングのような仕組みを作り、デプロイ中に他のデプロイできないようにすることが望ましい。
デプロイ後、モニタリングツールを使って確認し、問題がなければ、masterに変更をmergeする。その後、キューンイングで待っている他の人のデプロイを走らせる。
<br><br><br>



## 3.6.1.3 GitHub-flowを適用するメリット

- シンプルで習得が簡単
- リリースの手続きが簡単、早い
- リリースのリスクが低く、ストレスが少ない
- 頻繁にフィードバックを得られる
- マージに置ける衝突が少ない
- 開発者としてオーナーシップを感じて、達成感と責任感が高まる
<br><br><br>

## 3.6.1.4 どのようにすれば実現できるか

- 変更を小さくする
  - イメージとして、5行、10行などの単位でpull requestを作る
- アプリケーションが開発中かどうか、どのような状態かをわかるようにする
- カナリアリリース（フィーチャーフラグ）を使って、リスクを低減させる
- ツールの活用
  - Chatツール（ChatOps）
  - 監視ツール（Kibanaなど）
  - グラフツール（Chat上でも見れるといい）
  - テストツール
  - CI/CDツール
<br><br><br>


## 3.6.1.5 GitHub-flowの流れ

